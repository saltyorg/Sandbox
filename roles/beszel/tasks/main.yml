#########################################################################
# Title:            Sandbox: Beszel                                     #
# Author(s):        f4bio                                               #
# URL:              https://github.com/saltyorg/Sandbox                 #
# --                                                                    #
#########################################################################
#                   GNU General Public License v3.0                     #
#########################################################################
---
- name: Add DNS record
  ansible.builtin.include_tasks: "{{ resources_tasks_path }}/dns/tasker.yml"
  vars:
    dns_record: "{{ lookup('vars', role_name + '_dns_record') }}"
    dns_zone: "{{ lookup('vars', role_name + '_dns_zone') }}"
    dns_proxy: "{{ lookup('vars', role_name + '_dns_proxy') }}"

- name: Remove existing Docker container
  ansible.builtin.include_tasks: "{{ resources_tasks_path }}/docker/remove_docker_container.yml"

- name: Create directories
  ansible.builtin.include_tasks: "{{ resources_tasks_path }}/directories/create_directories.yml"

- name: Create Docker container
  ansible.builtin.include_tasks: "{{ resources_tasks_path }}/docker/create_docker_container.yml"

- name: Prompt for universal token
  ansible.builtin.pause:
    prompt: "Go to Beszel Hub at {{ beszel_web_url }}/settings/tokens, activate and paste Universal token (e.g.: 'a68a9a0b-1337-1ee7-i33t-756df1b0e034')"
  register: universal_token

# - name: Prompt user for agent token
#   ansible.builtin.pause:
#     prompt: "Go to your Beszel Hub ({{ beszel_web_url }}), add new system and enter the token displayed (e.g., 'a68a9a0b-1337-1ee7-i33t-756df1b0e034')"
#   register: agent_token

# - name: Prompt user for agent key 
#   ansible.builtin.pause:
#     prompt: "...and the corresponding agent key (e.g., 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC2YufokpaoKXT5mimcuu0JdfWadErOGAC6hn8+yB5D+')"
#   register: agent_key

- name: "Import Agent Role"
  ansible.builtin.include_role:
    name: beszel_agent
  vars:
    beszel_hub_url: "{{ beszel_web_url }}"
    beszel_universal_token: "{{ universal_token.user_input }}"